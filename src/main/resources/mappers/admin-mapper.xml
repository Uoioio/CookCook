<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Admin">
	<insert id="insertGptCount">
		insert into gptCount values(${memberCode}, ${mealSuccess}, ${mealFail}, ${basketSuccess}, ${basketFail})
	</insert>
	<insert id="insertLoginCount">
		insert into loginCount values(${memberCode}, ${count}, null)
	</insert>
	<delete id="deleteBannedMember">
		delete from member where code = ${code}
	</delete>
	<insert id="insertBannedMember">
		insert into BannedMember values(${code}, ${memberCode},#{id}, #{businessID}, #{pw}, #{name}, #{companyName}, #{authGradeCode}, #{nickName},#{birthDate},#{phone},#{eMail},#{shippingCompany},#{zipcode},#{address1},#{address2},#{agree},DEFAULT)
		<selectKey keyProperty="code" order="BEFORE" resultType="int">
			select banMember_seq.nextval from dual
		</selectKey>
	</insert>
	<update id="updateLoginCount">
		update loginCount set count = (select count from loginCount where memberCode = ${memberCode})+1 , loginDate = DEFAULT where memberCode = ${memberCode}
	</update>
	<select id="login" resultType="boolean">
		select count(*) from Member where id = #{id} and pw = #{pw}
	</select>
	<select id="selectAdminMemberInfo"
		resultType="cc.spring.dto.MemberDTO">
		select * from Member where id = #{id} and pw = #{pw}
	</select>
	<!-- GPT 이용 통계 -->
	<select id="selectSuccessMeal" resultType="int">
		select
		sum(mealSuccess) as mealSuccess_Total from GPTCOUNT
	</select>
	<select id="selectFailMeal" resultType="int">
		select sum(mealFail) as
		meal_Total from GPTCOUNT
	</select>
	<select id="selectSuccessBasket" resultType="int">
		select
		sum(basketSuccess) as basketSuccess_Total from GPTCOUNT
	</select>
	<select id="selectFailBasket" resultType="int">
		select sum(basketFail)
		as basketFail_Total from GPTCOUNT
	</select>
	<select id="selectTotalSuccess" resultType="int">
		select
		(sum(mealSuccess)+sum(basketSuccess)) from GPTCOUNT
	</select>
	<select id="selectTotalFail" resultType="int">
		select
		(sum(mealFail)+sum(basketFail)) from GPTCOUNT
	</select>
	<!-- 관리자 클라이언트회원목록 리스트 -->
	<select id="clientUserList" resultType="cc.spring.dto.MemberDTO">
		SELECT B.ID,
		COUNT(R.CODE)AS
		REPORTCOUNT,b.nickname,b.companyName,b.email,b.regDate
		FROM MEMBER b
		left join REPORT R ON B.CODE = R.REPORTEECODE
		where b.authgradecode=1003
		GROUP BY B.ID,b.nickname,b.companyName,b.email,b.regDate
	</select>
	<!-- 관리자 판매자 회원목록 리스트 -->
	<select id="businessUserList"
		resultType="cc.spring.dto.MemberDTO">
		SELECT B.businessid, COUNT(R.CODE)AS REPORTCOUNT
		, b.name, b.companyName, b.email, b.regDate FROM MEMBER b
		left join REPORT R ON B.CODE = R.REPORTEECODE
		where b.authgradecode=1002
		GROUP BY
		B.businessid,b.name,b.companyName,b.email,b.regDate
	</select>
	<!-- 최근 방문자 수 -->
	<select id="recentVisitClient" resultType="int">
		select count(*) from (select lc.*, m.authGradeCode 
		from loginCount lc left join member m on lc.memberCode=m.code) 
		where authGradeCode=1003 and loginDate>=to_date(sysdate-7)
	</select>
	<select id="recentVisitBusiness" resultType="int">
		select count(*) from (select lc.*, m.authGradeCode 
		from loginCount lc left join member m on lc.memberCode=m.code) 
		where authGradeCode=1002 and loginDate>=to_date(sysdate-7)
	</select>
</mapper>